[tox]
isolated_build = True
envlist = py{38}-pydantic{1,2}-pysimdjson{2,3,4,5},\
          py{39,310}-pydantic{1,2}-pysimdjson{3,4,5},\
          py{311}-pydantic{1,2}-pysimdjson{3,5}
toxworkdir = {env:TOXDIR:.tox}

[testenv]
passenv=
    PYTHON*
    PIP_*

usedevelop = true

deps =
    pytest
    pydantic1: pydantic~=1.0
    pydantic2: pydantic~=2.0
    pysimdjson2: pysimdjson~=2.0
    pysimdjson3: pysimdjson~=3.0
    pysimdjson4: pysimdjson~=4.0
    pysimdjson5: pysimdjson~=5.0

commands = pytest tests

[testenv:mypy-pydantic{1,2}]
labels = mypy
basepython = python3.8
deps =
    mypy
    pydantic1: pydantic~=1.0
    pydantic2: pydantic~=2.0

commands =
    pydantic1: mypy simdjson_schemaful --exclude simdjson_schemaful/pydantic/v2.py
    pydantic2: mypy simdjson_schemaful --exclude simdjson_schemaful/pydantic/v1.py
